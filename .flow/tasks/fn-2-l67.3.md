# fn-2-l67.3 移植核心技能 flow-next plan work interview

## Description

移植核心技能到 Factory 格式: flow-next, flow-next-plan, flow-next-work, flow-next-interview。

**Size:** L
**Files:**
- `.factory/skills/flow-next/SKILL.md`
- `.factory/skills/flow-plan/SKILL.md` + `steps.md`
- `.factory/skills/flow-work/SKILL.md` + `phases.md`
- `.factory/skills/flow-interview/SKILL.md`

## Approach

1. 从源仓库复制技能文件
2. 修改 description 为语义触发格式（非 slash command）
3. 添加 Verification 节到每个 SKILL.md
4. 替换 `$CLAUDE_PLUGIN_ROOT` 为动态 repo root（含降级处理）
5. 移除 `context: fork` 和 `allowed-tools` 依赖
6. 合并相关 commands 到 description

## Factory-Specific Modifications

### Description 重写示例

| 原始 (Claude Code) | 目标 (Factory) |
|-------------------|----------------|
| "Triggers: /flow-next:plan" | "Plan feature implementations with structured task breakdown and acceptance criteria" |
| "Use when user runs /flow-next:work" | "Execute implementation tasks with quality checks and commit workflow" |

### Verification 节模板

使用 4-backtick 格式避免嵌套代码块问题:

````markdown
## Verification

```bash
REPO_ROOT="${REPO_ROOT:-$(git rev-parse --show-toplevel 2>/dev/null || true)}"
if [ -z "$REPO_ROOT" ]; then
  echo "Error: Set REPO_ROOT=/absolute/path/to/repo (git rev-parse failed; cwd may be outside repo)."
  exit 1
fi

# 验证技能加载
ls "$REPO_ROOT/.factory/skills/flow-next/SKILL.md"
# 预期: 文件存在，退出码 0

# 验证 flowctl 可用
"$REPO_ROOT/.flow/bin/flowctl" list
# 预期: 退出码 0
```
````

### `$CLAUDE_PLUGIN_ROOT` 替换规则

- 作为目录引用时 → `$REPO_ROOT`
- 拼接 `/scripts/flowctl` 时 → `$REPO_ROOT/.flow/bin/flowctl`
- 引用模板/资源时 → `$REPO_ROOT/.flow/templates/` 或技能目录内

## Key context

- 源文件: `https://github.com/gmickel/gmickel-claude-marketplace/tree/af1a1aec8a11b3e2c4c8a510a28bfda15b392db9/plugins/flow-next/skills/`
- 保持 RepoPrompt 集成 (rp-cli 调用)
- 移除 hooks 依赖 (ralph-guard 相关)

## Acceptance

- [ ] flow-next SKILL.md 已创建，包含:
  - 语义 description（非 slash command）
  - Verification 节（使用正确的 4-backtick 格式）
  - 动态 repo root 路径（含降级处理）
- [ ] flow-plan SKILL.md + steps.md 已创建，包含:
  - 语义 description
  - Verification 节（使用正确的 4-backtick 格式）
  - 所有 `$CLAUDE_PLUGIN_ROOT` 已替换
- [ ] flow-work SKILL.md + phases.md 已创建，包含:
  - 语义 description
  - Verification 节（使用正确的 4-backtick 格式）
  - 移除 hooks 依赖
- [ ] flow-interview SKILL.md 已创建，包含:
  - 语义 description
  - Verification 节（使用正确的 4-backtick 格式）
- [ ] 所有技能文件 < 500 行

## Done summary
Ported 4 core skills (flow-next, flow-plan, flow-work, flow-interview) to Factory format with semantic descriptions, Verification sections using 4-backtick format, and dynamic $REPO_ROOT path resolution.
## Evidence
- Commits: 82151d498fe48c25ec7db193d670e84bf7a2624c
- Tests: wc -l (line count verification < 500)
- PRs: